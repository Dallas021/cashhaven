# Etapa 1: build
FROM node:20.18.3 AS builder

WORKDIR /app

# ğŸ”¹ Copia apenas os arquivos de dependÃªncia para aproveitar cache
COPY package*.json ./

# âœ… Instala as dependÃªncias
RUN npm install

# ğŸ”¹ Copia o restante do projeto (src, public, etc)
COPY . .

# âœ… Faz o build (sÃ³ funciona com as dependÃªncias jÃ¡ instaladas)
RUN npm run build

# Etapa 2: execuÃ§Ã£o (imagem final)
FROM node:20.18.3

WORKDIR /app

# ğŸ”¹ Copia o resultado do build e dependÃªncias para o container final
COPY --from=builder /app /app

# Expondo a porta padrÃ£o usada pelo preview (Vite)
EXPOSE 21066

# âœ… Roda o preview
CMD ["npm", "run", "preview"]

